import{r as k,c as b,a as u,i as v,o as c,b as d,d as a,w as f,t as g,F as L,e as D,f as m,g as N,v as E,h as y,j as _,k as C}from"./vendor.03e81442.js";const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}};S();function I(){const r=k(!1),e=b({get:()=>r.value,set:i=>{r.value=i,document.documentElement.setAttribute("data-theme",i?"dark":"light")}});return e.value=window.matchMedia("(prefers-color-scheme: dark)").matches,e}const w=`SELECT
                    IFNULL(ContentID,'') as 'ContentID',
                    IFNULL(Title,'') as 'BookTitle',
                    IFNULL(Subtitle,'') as 'SubTitle',
                    IFNULL(Attribution,'') as 'Author',
                    IFNULL(Publisher,'') as 'Publisher',
                    IFNULL(ISBN,0) as 'ISBN',
                    IFNULL(date(DateCreated),'') as 'ReleaseDate',
                    IFNULL(Series,'') as 'Series',
                    IFNULL(SeriesNumber,0) as 'SeriesNumber',
                    IFNULL(AverageRating,0) as 'Rating',
                    IFNULL(___PercentRead,0) as 'ReadPercent',
                    IFNULL(CASE WHEN ReadStatus>0 THEN datetime(DateLastRead) END,'') as 'LastRead',
                    IFNULL(___FileSize,0) as 'FileSize',
                    IFNULL(CASE WHEN Accessibility=1 THEN 'Store' ELSE CASE WHEN Accessibility=-1 THEN 'Import' ELSE CASE WHEN Accessibility=6 THEN 'Preview' ELSE 'Other' END END END,'') as 'Source'
                  FROM content
                  WHERE ContentType=6 AND ___UserId IS NOT NULL AND ___UserId != '' AND ___UserId != 'removed'
                  ORDER BY Source desc, Title`,R=r=>`SELECT
            '#' || row_number() over (partition by B.Title order by T.ContentID, T.ChapterProgress),
            TRIM(REPLACE(REPLACE(T.Text,CHAR(10),''),CHAR(9),''))
          FROM content AS B, bookmark AS T
          WHERE B.ContentID = T.VolumeID AND T.Text != '' AND T.Hidden = 'false' AND B.ContentID = '${r}'
          ORDER BY T.ContentID, T.ChapterProgress;`;var F=(r,e)=>{const i=r.__vccOpts||r;for(const[t,o]of e)i[t]=o;return i};const T={setup(){const r=u({isDark:I(),fileName:"Drop your .sqlite file here",dbData:"",importFile:t=>{const[o]=t.target.files||t.dataTransfer.files;r.fileName=o.name;const s=new FileReader;s.onload=async()=>{let n=await v();const h=new n.Database(new Uint8Array(s.result));r.dbData=h,e.Get()},s.readAsArrayBuffer(o)}}),e=A(r),i=x(r);return{setting:r,bookListData:e,highlightData:i}}};function A(r){const e=u({loading:!1,content:"",exportContent:b(()=>e.content.map(i=>(delete i.ContentID,i))),Get:()=>{const[i]=r.dbData.exec(w);e.loading=!0,e.content=i.values.map(t=>t.reduce((o,s,n)=>(o[i.columns[n]]=s,o),{}))},Export:i=>{let t="",o=JSON.parse(JSON.stringify(e.exportContent));switch(i){case"json":t=JSON.stringify(o);break;case"md":t+=`| ${Object.keys(o[0]).join(" | ")} |
`,t+=`| ${Object.keys(o[0]).reduce(s=>s+="--- | ","")}
`,delete o[0],t+=o.reduce((s,n)=>s+=`| ${Object.values(n).join(" | ")} |
`,"");break;case"csv":t+=`"${Object.keys(o[0]).join('","')}"
`,delete o[0],t+=o.reduce((s,n)=>s+=`"${Object.values(n).join('","')}"
`,"");break}p(`bookList.${i}`,t)}});return e}function x(r){const e=u({loading:!1,title:"",content:"",Get:(i,t)=>{const[o]=r.dbData.exec(R(i));e.loading=!0,e.title=t,e.content=o==null?void 0:o.values.join(`

`).split(",").join(`  
`)},Export:()=>{p(`${e.title}.md`,e.content)}});return e}const p=(r,e)=>{var i=document.createElement("a");Object.assign(i,{href:`data:text/plain;charset=utf-8,${encodeURIComponent(e)}`,download:r,display:"none"}),document.body.appendChild(i),i.click(),document.body.removeChild(i)},O={class:"container"},U={class:"switch-column"},B={class:"switch"},j=["checked"],H=a("span",{class:"slider"},null,-1),P=a("h1",{class:"title mb-4"},"Kobo Book Exporter",-1),M={class:"file mb-4"},W=a("span",{class:"small"},"* Connect your kobo reader to a computer. You can find .kobo directory (hidden by default). There should be a KoboReader.sqlite file. Drop a file here.",-1),V={key:0,class:"content mb-6"},G={class:"content-left"},K={class:"download-booklist"},J={class:"booklist"},q={class:"booklist-scroll"},Q=["onClick"],Y={class:"content-right"},z={class:"highlight-preview"},$={key:0,class:"highlight-details mb-2"},X={class:"highlight-title"},Z=y('<footer class="footer"> Created by <a href="https://github.com/mollykannn">Molly Kan</a> / Retrieved from <a href="http://www.vixual.net/blog/archives/117">Kobo Exporter: \u532F\u51FA Kobo \u96FB\u5B50\u66F8\u7684\u66F8\u7C4D\u6E05\u55AE\u8207\u8A3B\u8A18\u8CC7\u6599 (\u5283\u7DDA\u8207\u7B46\u8A18) | Vixual</a><br> Icons made by <a href="http://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a></footer>',1);function ee(r,e,i,t,o,s){return c(),d("div",O,[a("div",U,[a("label",B,[a("input",{type:"checkbox",onClick:e[0]||(e[0]=n=>t.setting.isDark=!t.setting.isDark),checked:t.setting.isDark},null,8,j),H])]),P,a("div",M,[a("div",{class:"file-upload mb-4",onClick:e[1]||(e[1]=f(n=>r.$refs.fileInput.click(),["prevent"])),onDragover:e[2]||(e[2]=f(()=>{},["prevent"])),onDrop:e[3]||(e[3]=f((...n)=>t.setting.importFile&&t.setting.importFile(...n),["prevent"]))},g(t.setting.fileName),33),a("input",{type:"file",ref:"fileInput",class:"hide",onChange:e[4]||(e[4]=(...n)=>t.setting.importFile&&t.setting.importFile(...n))},null,544),W]),t.bookListData.loading?(c(),d("div",V,[a("div",G,[a("div",K,[a("button",{onClick:e[5]||(e[5]=n=>t.bookListData.Export("json"))},"JSON file"),a("button",{onClick:e[6]||(e[6]=n=>t.bookListData.Export("md"))},"Markdown file"),a("button",{onClick:e[7]||(e[7]=n=>t.bookListData.Export("csv"))},"CSV file")]),a("div",J,[a("div",q,[(c(!0),d(L,null,D(t.bookListData.content,n=>(c(),d("div",{key:n.ContentID,class:"book-title",onClick:h=>t.highlightData.Get(n.ContentID,n.BookTitle)},g(n.BookTitle),9,Q))),128))])])]),a("div",Y,[a("div",z,[t.highlightData.loading?(c(),d("div",$,[a("div",X,g(t.highlightData.title),1),t.highlightData.content?(c(),d("button",{key:0,class:"highlight-export",onClick:e[8]||(e[8]=n=>t.highlightData.Export())},"Export")):m("",!0)])):m("",!0),N(a("textarea",{class:"highlight-textarea","onUpdate:modelValue":e[9]||(e[9]=n=>t.highlightData.content=n)},null,512),[[E,t.highlightData.content]])])])])):m("",!0),Z])}var te=F(T,[["render",ee]]);function oe(r={}){const{immediate:e=!1,onNeedRefresh:i,onOfflineReady:t,onRegistered:o,onRegisterError:s}=r;let n;const h=async(l=!0)=>{};return"serviceWorker"in navigator&&(n=new _("/kobo-book-exporter/sw.js",{scope:"/kobo-book-exporter/"}),n.addEventListener("activated",l=>{l.isUpdate?window.location.reload():t==null||t()}),n.register({immediate:e}).then(l=>{o==null||o(l)}).catch(l=>{s==null||s(l)})),h}const ne=oe({onNeedRefresh(){},onOfflineReady(){}});ne();C(te).mount("#app");
