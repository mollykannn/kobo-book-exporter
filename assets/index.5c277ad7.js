import{r as v,a as _,o as w,b as m,c as p,d as s,w as b,t as k,F as C,e as R,f as L,g as A,v as I,i as T,h as F,j as x,k as U}from"./vendor.dec8c306.js";const H=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}};H();var O=(d,t)=>{for(const[a,e]of t)d[a]=e;return d};const B={setup(){const d=v("Drop your .sqlite file here"),t=v(),a=_({loading:!1,content:""}),e=_({loading:!1,title:"",content:""}),n=v(),i=v();function o(c){var f=c.target.files||c.dataTransfer.files,r=new FileReader;d.value=f[0].name,r.onload=function(){T().then(function(l){var h=new l.Database(new Uint8Array(r.result));t.value=h;const N=[];h.each(`SELECT
              IFNULL(Title,'') as 'Book Title', 
              IFNULL(Subtitle,'') as 'Sub Title', 
              IFNULL(Attribution,'') as 'Author', 
              IFNULL(Publisher,'') as 'Publisher', 
              IFNULL(ISBN,0) as 'ISBN', 
              IFNULL(date(DateCreated),'') as 'Release Date',
              IFNULL(Series,'') as 'Series', 
              IFNULL(SeriesNumber,0) as 'SeriesNumber', 
              IFNULL(AverageRating,0) as 'Rating', 
              IFNULL(___PercentRead,0) as 'ReadPercent',
              IFNULL(CASE WHEN ReadStatus>0 THEN datetime(DateLastRead) END,'') as 'Last Read',
              IFNULL(___FileSize,0) as 'File Size',
              IFNULL(CASE WHEN Accessibility=1 THEN 'Store' ELSE CASE WHEN Accessibility=-1 THEN 'Import' ELSE CASE WHEN Accessibility=6 THEN 'Preview' ELSE 'Other' END END END,'') as 'Source'
            FROM content
              WHERE ContentType=6 AND ___UserId IS NOT NULL AND ___UserId != '' AND ___UserId != 'removed'
              ORDER BY Source desc, Title`,{},function(S){N.push(S)}),a.loading=!0,a.content=N;const D=h.exec(`SELECT 
              ContentID, 
              Title
            FROM content 
            WHERE ContentType = 6 AND ___UserId IS NOT NULL AND ___UserId != '' AND ___UserId != 'removed'
            ORDER BY DateLastRead DESC`);n.value=D[0].values})},r.readAsArrayBuffer(f[0])}function g(c){const f=`bookList.${c}`;let r="";c==="json"?r=JSON.stringify(a.content):c==="md"?a.content.forEach((l,h)=>{h===0&&(r+=`| ${Object.keys(l).toString().split(",").join(" | ")} |
`,r+=`${Object.keys(l).map(()=>"| --- ").toString().split(",").join("")}|
`),r+=`| ${Object.values(l).toString().split(",").join(" | ")} |
`}):a.content.forEach((l,h)=>{r+=h===0?`"${Object.keys(l).join('","')}"
`:"",r+=`"${Object.values(l).join('","')}"
`}),E(f,r)}function u(c,f){var l;const r=t.value.exec(`SELECT 
        '#' || row_number() over (partition by B.Title order by T.ContentID, T.ChapterProgress), 
        TRIM(REPLACE(REPLACE(T.Text,CHAR(10),''),CHAR(9),''))
        FROM content AS B, bookmark AS T
        WHERE B.ContentID = T.VolumeID AND T.Text != '' AND T.Hidden = 'false' AND B.ContentID = '${c}'
        ORDER BY T.ContentID, T.ChapterProgress;`);e.loading=!0,e.title=f,e.content=(l=r[0])==null?void 0:l.values.join(`

`).split(",").join(`  
`)}function E(c,f){const r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(f)),r.setAttribute("download",c),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}function y(){i.value=document.documentElement.getAttribute("data-theme")=="dark"?"light":"dark",document.documentElement.setAttribute("data-theme",i.value)}return w(()=>{i.value=window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark",document.documentElement.setAttribute("data-theme",i.value)}),{fileName:d,dbData:t,exportBookListData:a,exportHighlightData:e,bookTitleList:n,importFile:o,exportFile:E,downloadBookList:g,previewHighlight:u,changeMode:y,mode:i}}},j={class:"container"},M={class:"switch-column"},P={class:"switch"},W=["checked"],V=s("span",{class:"slider"},null,-1),K=s("h1",{class:"title"},"Kobo Book Exporter",-1),q={class:"file"},Y=s("span",{class:"small"},"* Connect your kobo reader to a computer. You can find .kobo directory (hidden by default). There should be a KoboReader.sqlite file. Drop a file here.",-1),J={key:0,class:"content"},z={class:"content-left"},G={class:"download-booklist"},Q={class:"booklist"},X={class:"booklist-scroll"},Z=["onClick"],$={class:"content-right"},ee={class:"highlight-preview"},te={key:0,class:"highlight-details"},oe={class:"highlight-title"},ne=F('<footer class="footer"> Created by <a href="https://github.com/mollykannn">Molly Kan</a> / Retrieved from <a href="http://www.vixual.net/blog/archives/117">Kobo Exporter: \u532F\u51FA Kobo \u96FB\u5B50\u66F8\u7684\u66F8\u7C4D\u6E05\u55AE\u8207\u8A3B\u8A18\u8CC7\u6599 (\u5283\u7DDA\u8207\u7B46\u8A18) | Vixual</a><br> Icons made by <a href="http://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a></footer>',1);function ie(d,t,a,e,n,i){return m(),p("div",j,[s("div",M,[s("label",P,[s("input",{type:"checkbox",onClick:t[0]||(t[0]=(...o)=>e.changeMode&&e.changeMode(...o)),checked:e.mode=="dark"},null,8,W),V])]),K,s("div",q,[s("div",{class:"file-upload",onClick:t[1]||(t[1]=b(o=>d.$refs.fileInput.click(),["prevent"])),onDragover:t[2]||(t[2]=b(()=>{},["prevent"])),onDrop:t[3]||(t[3]=b((...o)=>e.importFile&&e.importFile(...o),["prevent"]))},k(e.fileName),33),s("input",{type:"file",ref:"fileInput",class:"hide",onChange:t[4]||(t[4]=(...o)=>e.importFile&&e.importFile(...o))},null,544),Y]),e.exportBookListData.loading?(m(),p("div",J,[s("div",z,[s("div",G,[s("button",{onClick:t[5]||(t[5]=o=>e.downloadBookList("json"))},"JSON file"),s("button",{onClick:t[6]||(t[6]=o=>e.downloadBookList("md"))},"Markdown file"),s("button",{onClick:t[7]||(t[7]=o=>e.downloadBookList("csv"))},"CSV file")]),s("div",Q,[s("div",X,[(m(!0),p(C,null,R(e.bookTitleList,o=>(m(),p("div",{key:o.index,class:"bookTitle",onClick:g=>e.previewHighlight(o[0],o[1])},k(o[1]),9,Z))),128))])])]),s("div",$,[s("div",ee,[e.exportHighlightData.loading?(m(),p("div",te,[s("div",oe,k(e.exportHighlightData.title),1),e.exportHighlightData.content?(m(),p("button",{key:0,class:"highlight-export",onClick:t[8]||(t[8]=o=>e.exportFile(`${e.exportHighlightData.title}.md`,e.exportHighlightData.content))},"Export")):L("",!0)])):L("",!0),A(s("textarea",{class:"highlight-textarea","onUpdate:modelValue":t[9]||(t[9]=o=>e.exportHighlightData.content=o)},null,512),[[I,e.exportHighlightData.content]])])])])):L("",!0),ne])}var re=O(B,[["render",ie]]);function se(d={}){const{immediate:t=!1,onNeedRefresh:a,onOfflineReady:e,onRegistered:n,onRegisterError:i}=d;let o;const g=async(u=!0)=>{};return"serviceWorker"in navigator&&(o=new x("/kobo-book-exporter/sw.js",{scope:"/kobo-book-exporter/"}),o.addEventListener("activated",u=>{u.isUpdate?window.location.reload():e==null||e()}),o.register({immediate:t}).then(u=>{n==null||n(u)}).catch(u=>{i==null||i(u)})),g}const ae=se({onNeedRefresh(){},onOfflineReady(){}});ae();U(re).mount("#app");
