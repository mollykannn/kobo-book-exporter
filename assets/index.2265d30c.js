import{r as e,a as t,o,c as n,b as i,w as r,t as a,F as s,d as l,e as c,f as d,v as u,i as p,g as f,h,j as g}from"./vendor.7f926862.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var b=(e,t)=>{for(const[o,n]of t)e[o]=n;return e};const m={setup(){const o=e("Drop your .sqlite file here"),n=e(),i=t({loading:!1,content:""}),r=t({loading:!1,title:"",content:""}),a=e();function s(e,t){const o=document.createElement("a");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}return{fileName:o,dbData:n,exportBookListData:i,exportHighlightData:r,bookTitleList:a,importFile:function(e){var t=e.target.files||e.dataTransfer.files,r=new FileReader;o.value=t[0].name,r.onload=function(){p().then((function(e){var t=new e.Database(new Uint8Array(r.result));n.value=t;const o=[];t.each("SELECT\n              IFNULL(Title,'') as 'Book Title', \n              IFNULL(Subtitle,'') as 'Sub Title', \n              IFNULL(Attribution,'') as 'Author', \n              IFNULL(Publisher,'') as 'Publisher', \n              IFNULL(ISBN,0) as 'ISBN', \n              IFNULL(date(DateCreated),'') as 'Release Date',\n              IFNULL(Series,'') as 'Series', \n              IFNULL(SeriesNumber,0) as 'SeriesNumber', \n              IFNULL(AverageRating,0) as 'Rating', \n              IFNULL(___PercentRead,0) as 'ReadPercent',\n              IFNULL(CASE WHEN ReadStatus>0 THEN datetime(DateLastRead) END,'') as 'Last Read',\n              IFNULL(___FileSize,0) as 'File Size',\n              IFNULL(CASE WHEN Accessibility=1 THEN 'Store' ELSE CASE WHEN Accessibility=-1 THEN 'Import' ELSE CASE WHEN Accessibility=6 THEN 'Preview' ELSE 'Other' END END END,'') as 'Source'\n            FROM content\n              WHERE ContentType=6 AND ___UserId IS NOT NULL AND ___UserId != '' AND ___UserId != 'removed'\n              ORDER BY Source desc, Title",{},(function(e){o.push(e)})),i.loading=!0,i.content=o;const s=t.exec("SELECT \n              ContentID, \n              Title\n            FROM content \n            WHERE ContentType = 6 AND ___UserId IS NOT NULL AND ___UserId != '' AND ___UserId != 'removed'\n            ORDER BY DateLastRead DESC");a.value=s[0].values}))},r.readAsArrayBuffer(t[0])},exportFile:s,downloadBookList:function(e){const t=`bookList.${e}`;let o="";"json"===e?o=JSON.stringify(i.content):"md"===e?i.content.forEach(((e,t)=>{0===t&&(o+=`| ${Object.keys(e).toString().split(",").join(" | ")} |\n`,o+=`${Object.keys(e).map((()=>"| --- ")).toString().split(",").join("")}|\n`),o+=`| ${Object.values(e).toString().split(",").join(" | ")} |\n`})):i.content.forEach(((e,t)=>{o+=0===t?`"${Object.keys(e).join('","')}"\n`:"",o+=`"${Object.values(e).join('","')}"\n`})),s(t,o)},previewHighlight:function(e,t){var o;const i=n.value.exec(`SELECT \n        '#' || row_number() over (partition by B.Title order by T.ContentID, T.ChapterProgress), \n        TRIM(REPLACE(REPLACE(T.Text,CHAR(10),''),CHAR(9),''))\n        FROM content AS B, bookmark AS T\n        WHERE B.ContentID = T.VolumeID AND T.Text != '' AND T.Hidden = 'false' AND B.ContentID = '${e}'\n        ORDER BY T.ContentID, T.ChapterProgress;`);r.loading=!0,r.title=t,r.content=null==(o=i[0])?void 0:o.values.join("\n\n").split(",").join("  \n")}}}},L={class:"container"},v=i("h1",{class:"title"},"Kobo Book Exporter",-1),E={class:"file"},N=i("span",{class:"small"},"* Connect your kobo reader to a computer. You can find .kobo directory (hidden by default). There should be a KoboReader.sqlite file. Drop a file here.",-1),k={key:0,class:"content"},D={class:"content-left"},y={class:"download-booklist"},C={class:"booklist"},I={class:"booklist-scroll"},R=["onClick"],S={class:"content-right"},T={class:"highlight-preview"},w={key:0,class:"highlight-details"},A={class:"highlight-title"},F=f('<footer class="footer"> Created by <a href="https://github.com/mollykannn">Molly Kan</a> / Retrieved from <a href="http://www.vixual.net/blog/archives/117">Kobo Exporter: 匯出 Kobo 電子書的書籍清單與註記資料 (劃線與筆記) | Vixual</a><br> Icons made by <a href="http://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon"> www.flaticon.com</a></footer>',1);var x=b(m,[["render",function(e,t,p,f,h,g){return o(),n("div",L,[v,i("div",E,[i("div",{class:"file-upload",onClick:t[0]||(t[0]=r((t=>e.$refs.fileInput.click()),["prevent"])),onDragover:t[1]||(t[1]=r((()=>{}),["prevent"])),onDrop:t[2]||(t[2]=r(((...e)=>f.importFile&&f.importFile(...e)),["prevent"]))},a(f.fileName),33),i("input",{type:"file",ref:"fileInput",class:"hide",onChange:t[3]||(t[3]=(...e)=>f.importFile&&f.importFile(...e))},null,544),N]),f.exportBookListData.loading?(o(),n("div",k,[i("div",D,[i("div",y,[i("button",{onClick:t[4]||(t[4]=e=>f.downloadBookList("json"))},"JSON file"),i("button",{onClick:t[5]||(t[5]=e=>f.downloadBookList("md"))},"Markdown file"),i("button",{onClick:t[6]||(t[6]=e=>f.downloadBookList("csv"))},"CSV file")]),i("div",C,[i("div",I,[(o(!0),n(s,null,l(f.bookTitleList,(e=>(o(),n("div",{key:e.index,class:"bookTitle",onClick:t=>f.previewHighlight(e[0],e[1])},a(e[1]),9,R)))),128))])])]),i("div",S,[i("div",T,[f.exportHighlightData.loading?(o(),n("div",w,[i("div",A,a(f.exportHighlightData.title),1),f.exportHighlightData.content?(o(),n("button",{key:0,class:"highlight-export",onClick:t[7]||(t[7]=e=>f.exportFile(`${f.exportHighlightData.title}.md`,f.exportHighlightData.content))},"Export")):c("",!0)])):c("",!0),d(i("textarea",{class:"highlight-textarea","onUpdate:modelValue":t[8]||(t[8]=e=>f.exportHighlightData.content=e)},null,512),[[u,f.exportHighlightData.content]])])])])):c("",!0),F])}]]);(function(e={}){const{immediate:t=!1,onNeedRefresh:o,onOfflineReady:n,onRegistered:i,onRegisterError:r}=e;let a;return"serviceWorker"in navigator&&(a=new h("/kobo-book-exporter/sw.js",{scope:"/kobo-book-exporter/"}),a.addEventListener("activated",(e=>{e.isUpdate?window.location.reload():null==n||n()})),a.register({immediate:t}).then((e=>{null==i||i(e)})).catch((e=>{null==r||r(e)}))),async(e=!0)=>{}})({onNeedRefresh(){},onOfflineReady(){}})(),g(x).mount("#app");
